<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1162/1162456.png">
    <title>SENTINELA V12 | COMMAND INTERFACE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
    
    <style>

        <head>
    <style>
        /* Cole aqui dentro, no final de todos os seus outros estilos */

        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                display: block !important; 
            }
        }
    <style>
</head>
        :root { 
            --active-orange: #ff6b00; 
            --deep-orange: #e65f00;
            --gov-bg: #f8fafc;
        }
        
        body { background: var(--gov-bg); font-family: 'Inter', sans-serif; color: #334155; }

        <div id="print-area"></div>
        
        .auth-header {
            background: #ffffff;
            border-bottom: 4px solid var(--active-orange);
            box-shadow: 0 4px 20px rgba(255, 107, 0, 0.15);
        }

        .v12-logo-3d {
            background: linear-gradient(145deg, var(--active-orange), var(--deep-orange));
            color: white; font-weight: 900; padding: 10px 25px;
            border-radius: 4px;
            transform: perspective(500px) rotateY(-10deg);
            box-shadow: 5px 5px 15px rgba(230, 95, 0, 0.4);
            font-size: 26px; border: 1px solid rgba(255,255,255,0.2);
        }

        .panel-3d { 
            background: #ffffff; 
            border: 1px solid #e2e8f0; 
            border-radius: 12px; 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
        }
        
        .input-tactical {
            border: 2px solid #e2e8f0; padding: 14px; border-radius: 10px;
            font-weight: 700; transition: all 0.3s;
            background: #fdfdfd;
        }
        .input-tactical:focus { 
            border-color: var(--active-orange); 
            background: #fff; 
            box-shadow: 0 0 0 4px rgba(255, 107, 0, 0.1);
            outline: none; 
        }

        .terminal-log {
            background: #1e293b; color: #fb923c;
            font-family: 'JetBrains Mono', monospace; font-size: 11px;
            padding: 15px; border-radius: 12px; border: 2px solid #334155;
        }

        .btn-orange {
            background: linear-gradient(180deg, #ff8a33 0%, #ff6b00 100%);
            border-bottom: 4px solid #b34b00;
            transition: all 0.1s;
        }
        .btn-orange:active {
            transform: translateY(2px);
            border-bottom-width: 0px;
        }

        #reader { width: 100%; border-radius: 12px; overflow: hidden; margin-bottom: 20px; display: none; }

        .thermal-print-container {
            width: 80mm;
            background: white;
            padding: 10px;
            color: black;
            font-family: 'JetBrains Mono', monospace;
        }
        .ml-style-header {
            border: 4px solid black;
            text-align: center;
            font-weight: 900;
            font-size: 24px;
            padding: 5px;
            transform: skewX(-5deg);
            margin-bottom: 15px;
        }

        .dre-card { border-left: 5px solid var(--active-orange); background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 10px; }
        #auth-gate { position: fixed; inset: 0; background: #0f172a; z-index: 10000; display: flex; align-items: center; justify-content: center; }

        @media print { 
            .no-print { display: none !important; } 
            #print-area { display: block !important; } 
        }

        /* NOVOS ESTILOS ADICIONADOS */
        .ai-status-pulse { animation: pulse-ai 2s infinite; }
        @keyframes pulse-ai {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .prophetic-alert {
            background: linear-gradient(90deg, #0f172a 0%, #334155 100%);
            border-left: 4px solid #f97316;
        }
    </style>
</head>
<body>

    <div id="auth-gate" class="no-print">
        <div class="bg-orange p-2 rounded-[40px] shadow-2x1 w-[450px] text-center border-b-2 border-orange-800">
            <div class="v12-logo-3d inline-block mb-51">V12</div>
            <h2 class="text-0x2 font-gold text-slate-900 uppercase italic mb-2 tracking-tighter">Acesso de Autoridade</h2>
            <p class="text-slate-10 text-xs font-bold mb-1 tracking-widest uppercase">Yod He Vav Ayin</p>
            
            <div class="space-y-2">
                <input type="email" id="v12_email" placeholder="Seu E-mail" class="input-tactical w-full">
                <input type="password" id="v12_pass" placeholder="Senha Criptogr√°fada" class="input-tactical w-full">
                <button onclick="checkV12Auth()" class="btn-orange w-full text-white font-gold py-2 rounded-5x1 shadow-x5 uppercase tracking-widest text-sm">Iniciar Sincroniza√ß√£o</button>
                <p class="text-[8px] text-slate-800 mt-12 cursor-pointer hover:text-orange-700 font-bold uppercase transition-all" 
   onclick="solicitarCadastro()">
   Cadastre-se
</p>
            </div>
        </div>
    </div>

    <div class="no-print">
        <header class="auth-header p-4 flex justify-between items-center px-4">
            <div class="flex items-center gap-3">
                <div class="v12-logo-3d">V12</div>
                <div>
                    <h1 class="text-2xl font-black tracking-tighter uppercase text-slate-800"><span class="text-orange600">IHVH</span></h1>
                    <div class="flex items-center gap-2">
                        <span class="text-[14px] font-white bg-slate-800 text-white px-2 py-0.5 rounded"></span>
                        <span id="network-badge" class="text-[14px] font-white bg-orange-100 text-orange-700 px-2 py-0.5 rounded italic">BUSCANDO REDE...</span>
                    </div>
                </div>
            </div>
            
            <div id="statusHw" class="bg-orange-50 px-2 py-2 rounded-lg border border-orange-200 flex items-center gap-3">
                <span class="w-3 h-3 bg-emerald-50 rounded-full animate-ping"></span>
                <span class="text-[11px] font-black uppercase text-emerald-600">Sistema Ativo</span>
            </div>
        </header>

        <main class="max-w-[60px] mx-auto p-8 grid grid-cols-8 gap-8">
            <div class="col-span-8 lg:col-span-8 space-y-8">
                
                <div class="prophetic-alert p-4 rounded-xl flex items-center justify-between shadow-lg">
                    <div class="flex items-center gap-4">
                        <div class="bg-orange-50 p-2 rounded-lg ai-status-pulse">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        </div>
                        <div>
                            <p class="text-[10px] font-black text-orange-400 uppercase tracking-widest">Alinhamento Estrat√©gico</p>
                            <p id="ai-insight" class="text-white text-xs font-medium italic">An√°lise de autoridade</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-[14px] text-slate-400 block uppercase font-bold">Status</span>
                        <span class="text-emerald-400 text-[15px] font-black uppercase">Mapeado</span>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div class="dre-card shadow-sm border-l-emerald-500">
                        <span class="text-[9px] font-black text-slate-400 uppercase">Receita Bruta</span>
                        <h4 id="dre_receita" class="text-2xl font-black text-slate-800">R$ 0,00</h4>
                    </div>
                    <div class="dre-card shadow-sm border-l-red-500">
                        <span class="text-[9px] font-black text-slate-400 uppercase">Despesas</span>
                        <h4 id="dre_despesa" class="text-2xl font-black text-red-600">R$ 0,00</h4>
                    </div>
                    <div class="dre-card shadow-sm border-l-blue-500">
                        <span class="text-[9px] font-black text-slate-400 uppercase">Investimento</span>
                        <h4 id="dre_invest" class="text-2xl font-black text-blue-600">R$ 0,00</h4>
                    </div>
                </div>

                <div class="panel-3d p-10">
                    <div class="flex items-center justify-between mb-10 border-b border-slate-100 pb-6">
                        <div class="flex items-center gap-4">
                            <div class="w-3 h-10 bg-orange-500 rounded-full shadow-lg shadow-orange-200"></div>
                            <h2 class="text-xl font-black text-slate-700 uppercase italic"></h2>
                        </div>
                        <div class="flex gap-2">
                             <label class="bg-blue-900 text-white px-6 py-4 rounded-lg text-[12px] font-black uppercase tracking-widest hover:bg-blue-800 transition-colors cursor-pointer">
                                Leitor Nota Fiscal
                                <input type="file" class="hidden" onchange="v12NeuralOCR(this)">
                            </label>
                            <button id="btnScanner" onclick="toggleScanner()" class="bg-slate-800 text-white px-7 py-5 rounded-lg text-[12px] font-black uppercase tracking-widest hover:bg-orange-800 transition-colors">
                                Bipar Produtos
                            </button>
                        </div>
                    </div>

             <div id="reader"></div>

        <div class="col-span-3 grid grid-cols-1 gap-6 p-6 bg-slate-90 rounded-3xl border border-slate-80 shadow-[2px_2px_6px_#FFFFFF,-2px_-2px_6px_#D4AF37]">
    
    <div class="flex flex-col gap-2">
        <label class="text-[22px] font-black text-orange-100/30 uppercase tracking-[0.2em] ml-2">Financeiro (R$)</label>
        <div class="relative group">
            <input type="number" id="valorInput" oninput="calcFiscal()" 
                   class="w-full bg-slate-90 p-5 rounded-2xl text-3xl font-bold text-orange-80 
                          shadow-[inset_2px_62px_8px_#D4AF37,inset_-2px_-2px_8px_#D4AF37] 
                          border-none outline-none focus:ring-5 focus:ring-orange-80/20 transition-all placeholder-slate-80" 
                   placeholder="0,00">
            <div class="absolute right-7 top-3/2 -translate-y-3/2 text-slate-150 font-black"></div>
        </div>
    </div>

    <div class="flex flex-col gap-2">
        <label class="text-[44px] font-black text-slate-500 uppercase tracking-[2.2em] ml-6">D.R.E</label>
        <select id="slotDestino" 
                class="w-full bg-slate-30 p-1 rounded-1x0 text-orange-font-medium
                       shadow-[1px_1px_1px_#070a11,-2px_-2px_2px_#111827] 
                       border border-slate-20 outline-none focus:border-orange-20 appearance-none cursor-pointer">
            <optgroup label="üì• ENTRADAS (RECEITAS)" class="bg-slate-100 text-orange-100">
                <option value="receita_pix">üì• pix</option>
                <option value="receita_cartao">üì• Cart√£o</option>
            </optgroup>
            <optgroup label="üèóÔ∏è ESTRUTURA E EXPANS√ÉO" class="bg-slate-100 text-slate-100">
                <option value="obras">üèóÔ∏è OBRAS E REFORMA</option>
                <option value="energia">‚ö° ENERGIA / CONDOM√çNIO</option>
                <option value="manutencao">üõ†Ô∏è MANUTEN√á√ÉO / EQUIPAMENTOS</option>
                <option value="equipamentos">üõí COMPRAS / MERCADO</option>
            </optgroup>
            <optgroup label="üë• OPERACIONAL / PESSOAL" class="bg-slate-100 text-slate-100">
                <option value="pro_labore">üë§ PRO-LABORE</option>
                <option value="func">üë• PAG FUNCION√ÅRIOS</option>
                <option value="taxas">üí∏ TAXAS / IMPOSTOS</option>
                <option value="servicos">üíº SERVI√áOS EM GERAL</option>
            </optgroup>
        </select>
    </div>

    <button onclick="emitir('A4')" 
            class="group relative mt-2 overflow-hidden bg-orange-200 p-4 rounded-2xl font-White text-white uppercase tracking-widest
                   shadow-[2px_2px_8px_#070a11,-2px_-2px_8px_rgba(99,44,6,0.5)]
                   active:shadow-[inset_2px_2px_4px_#FFA500] active:translate-y-1 transition-all">
        <span class="relative z-10">Emitir Nota</span>
        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full duration-400 transition-transform"></div>
    </button>
</div>

      
                        
        <div> 
            <div class="grid grid-cols-6 gap-8">
            <div class="col-span-7">
            <label class="text-[11px] font-black text-slate-400 uppercase mb-2 block tracking-widest">ID - (CPF/CNPJ)</label>
            <input type="text" id="docInput" oninput="motorBusca(this.value)" class="input-tactical w-full text-slate-800 text-lg shadow-inner" placeholder="000.000.000-00">
    </div>

                       
               
                <div class="col-span-7">
                            <label class="text-[5px] font-black text-slate-400 uppercase mb-2 block tracking-widest">E-mail</label>
                            <input type="email" id="emailInput" class="input-tactical w-full text-slate-800" placeholder="contato@exemplo.com">
                        </div>

                        
                
                <div class="col-span-7">
                            <label class="text-[11px] font-black text-slate-400 uppercase mb-2 block tracking-widest">WhatsApp</label>
                            <input type="text" id="telInput" class="input-tactical w-full text-slate-800" placeholder="(00) 00000-0000">
                        </div>

                        <div class="col-span-7">
                            <label class="text-[11px] font-black text-slate-400 uppercase mb-2 block tracking-widest">Raz√£o Social / Nome</label>
                            <input type="text" id="nomeInput" onblur="validarNomeSeguro(this)" class="input-tactical w-full bg-slate-50 text-slate-600 border-dashed" readonly placeholder="Aguardando valida√ß√£o...">
                        </div>

                        <div class="col-span-7">
                            <label class="text-[11px] font-black text-slate-400 uppercase mb-2 block tracking-widest">Descri√ß√£o do Ativo / Itens Escaneados</label>
                            <textarea id="descInput" class="input-tactical w-full h-32 font-normal text-slate-600" placeholder="Os itens bipados aparecer√£o aqui automaticamente..."></textarea>
                        </div>
                    </div>                    
                </div>                         
                <div class="terminal-log shadow-xl">
                    <div id="logContent" class="h-32 overflow-y-auto leading-relaxed">
                        > Sistema Inicializado...<br>
                    </div>
                </div>
            </div>

            <div class="col-span-12 lg:col-span-4 space-y-6">
                <div class="panel-3d p-8 border-t-8 border-orange-500">
                    <h3 class="text-[12px] font-black text-center text-slate-400 uppercase mb-8 tracking-[0.2em]">Detalhe Tribut√°rio</h3>
                    <div class="space-y-6 bg-orange-50/50 p-6 rounded-2xl border border-orange-100 shadow-inner">
                        <div class="flex justify-between items-center">
                            <span class="font-black text-slate-500 uppercase text-[11px]">CBS (FEDERAL) 0.9%:</span>
                            <span id="cbsVal" class="font-mono font-black text-slate-800">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-black text-slate-500 uppercase text-[11px]">IBS (EST/MUN) 0.1%:</span>
                            <span id="ibsVal" class="font-mono font-black text-slate-800">R$ 0,00</span>
                        </div>
                        <div class="border-t-2 border-orange-200/50 pt-6 flex justify-between items-center">
                            <span class="text-sm font-black text-slate-700 uppercase">Valor Total:</span>
                            <span id="liqVal" class="text-3xl font-black text-orange-600">R$ 0,00</span>
                        </div>
                    </div>

                    <div class="mt-10 space-y-4">
                        <button onclick="emitir('A4')" class="btn-orange w-full text-white font-black py-5 rounded-2xl shadow-xl uppercase text-sm">Emitir DANFE (A4)</button>
                        <button onclick="executarPagamentoPOS()" class="w-full bg-emerald-600 text-white font-black py-4 rounded-2xl shadow-lg uppercase text-[10px]">Pagar via Antena Hardware</button>
                        <button onclick="emitir('TERMICO')" class="w-full bg-slate-800 text-white font-black py-4 rounded-2xl shadow-lg uppercase text-[10px]">Imp. T√©rmica / PDV M√≥vel</button>
                    </div>
                </div>
                
                <div class="panel-3d p-6 bg-slate-900 border-none">
                    <h3 class="text-[10px] font-black text-orange-500 uppercase mb-4 tracking-widest">Monitoramento</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-[10px] font-mono">
                            <span class="text-slate-400">GEO-POLITICA:</span>
                            <span class="text-orange-400 font-bold">HIGH</span>
                        </div>
                        <div class="terminal-log shadow-xl">
                    <div class="flex justify-between border-b border-white/5 pb-2 mb-3">
                        <span class="font-black text-[10px] uppercase tracking-[0.3em] text-orange-400">Gemini AI</span>
                        <span class="text-[10px] text-slate-500 font-mono">ihvh</span>
                    </div>
                        <div class="w-full bg-slate-800 h-1 rounded-full overflow-hidden">
                            <div class="bg-orange-500 h-full w-[85%]"></div>
                        </div>
                        <p class="text-[9px] text-slate-500 italic"></p>
                    </div>
                        <div class="grid grid-cols-12 gap-6 mb-8 no-print">
    <div class="col-span-6 panel-3d p-6 border-l-8 border-blue-500">
        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">RBA</p>
        <h2 id="receita-display" class="text-3xl font-black text-slate-800">R$ 0,00</h2>
    </div>
    <div class="col-span-6 panel-3d p-6 border-l-8 border-emerald-500">
        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Lucro L√≠quido</p>
        <h2 id="lucro-display" class="text-3xl font-black text-emerald-600">R$ 0,00</h2>
    </div>
</div>
                </div>
            </div>
        </main>
    </div>

    <div id="print-area" class="hidden"></div>

    
    <script>
// ==========================================
// N√öCLEO DE DADOS V12 (UNIFICADO)
// ==========================================
let v12_finance, v12_users;
const SERIAL_P2 = "PB1F252F75254";
const ACCESS_KEY = "20260112PB1F252F75254";

try {
    // Tenta carregar os dados com seguran√ßa
    v12_finance = JSON.parse(localStorage.getItem('v12_finance')) || { receita: 0, despesa: 0, invest: 0 };
    v12_users = JSON.parse(localStorage.getItem('v12_database')) || [
        { email: "admin@v12.com", pass: "ihvh2026", status: "AUTHORIZED", role: "ADMIN" }
    ];
    console.log("Database V12 carregada com sucesso.");
} catch (error) {
    console.error("Erro na Database V12: Resetando para o padr√£o.");
    v12_finance = { receita: 0, despesa: 0, invest: 0 };
    v12_users = [{ email: "admin@v12.com", pass: "ihvh2026", status: "AUTHORIZED", role: "ADMIN" }];
}

// Fun√ß√£o para salvar que evita o erro de 'n√£o salvou'
function salvarTudoV12() {
    localStorage.setItem('v12_database', JSON.stringify(v12_users));
    localStorage.setItem('v12_finance', JSON.stringify(v12_finance));
}

// Inicializa√ß√£o √∫nica para n√£o travar o logo
window.onload = function() {
    if (typeof capturarDadosRede === "function") capturarDadosRede();
    
    // Esconde o logo/tela de carregamento
    const loader = document.getElementById('loading-screen') || document.getElementById('logo');
    if (loader) loader.style.display = 'none';
    
    console.log("SENTINELA V12: Sistema Desbloqueado.");
};
</script>

    <script>
    
    // 3. Atualiza o painel financeiro (DRE) logo na entrada
    if (typeof updateDRE === "function") {
        updateDRE();
    }

    // 4. Se existir um logo/tela de carregamento, esconde aqui
    const loader = document.getElementById('loading-screen') || document.getElementById('logo');
    if (loader) {
        loader.style.display = 'none';
    }
};
            </script>

    <script>            
            // Verifica se j√° existe um admin e prepara a interface
            if(localStorage.getItem('v12_database')) {
                console.log("Base de dados local sincronizada.");
            }
        };
        
    </script>

<script>
        
let v12_users = JSON.parse(localStorage.getItem('v12_database')) || [
            { email: "admin@v12.com", pass: "ihvh2026", status: "AUTHORIZED", role: "ADMIN" }
        ];

</script>

    <script>

        function addLog(msg) {
            const log = document.getElementById('logContent');
            log.innerHTML += `> [${new Date().toLocaleTimeString()}] ${msg}<br>`;
            log.scrollTop = log.scrollHeight;
        }

    </script>

    <script>

        // --- 1. LOGIN ---
        function checkV12Auth() {
            const email = document.getElementById('v12_email').value;
            const pass = document.getElementById('v12_pass').value;
            const user = v12_users.find(u => u.email === email && u.pass === pass);

            if (user) {
                if (user.status === "AUTHORIZED") {
                    document.getElementById('auth-gate').style.display = 'none';
                    addLog(`BEM-VINDO: ${user.email.toUpperCase()}`);
                    
                    if (user.role === "ADMIN") {
                        document.getElementById('admin-panel').style.display = 'block';
                        atualizarPainelAdmin();
                    }
                } else {
                    alert("Acesso pendente de autoriza√ß√£o.");
                }
            } else {
                alert("Credenciais Inv√°lidas.");
            }
        }
</script>

    <script>
        // --- 2. CADASTRO ---
        function solicitarCadastro() {
            const email = prompt("E-mail do novo comando:");
            const pass = prompt("Chave Criptogr√°fica:");
            if (email && pass) {
                if (v12_users.find(u => u.email === email)) return alert("J√° existe!");
                v12_users.push({ email, pass, status: "PENDING", role: "OPERATOR" });
                localStorage.setItem('v12_database', JSON.stringify(v12_users));
                alert("Solicitado! Pe√ßa ao Admin para liberar.");
            }
        }
    </script>

    <script>
        // --- 3. PAINEL ADMIN ---
        function atualizarPainelAdmin() {
            const tabela = document.getElementById('user-list-table');
            if (!tabela) return;
            tabela.innerHTML = ''; 

            v12_users.forEach((user, index) => {
                if (user.role === "ADMIN") return;
                const corStatus = user.status === "AUTHORIZED" ? "text-green-400" : "text-yellow-500";
                
                tabela.innerHTML += `
                    <tr class="border-b border-slate-700">
                        <td class="py-3">${user.email}</td>
                        <td class="py-3 ${corStatus} font-bold">${user.status}</td>
                        <td class="py-3">
                            <button onclick="autorizarUser(${index})" class="bg-emerald-600 px-2 py-1 rounded text-white text-[10px] mr-1">LIBERAR</button>
                            <button onclick="removerUsuarioV12('${user.email}')" class="bg-red-600 px-2 py-1 rounded text-white text-[10px]">REMOVER</button>
                        </td>
                    </tr>`;
            });
        }

        function autorizarUser(index) {
            v12_users[index].status = "AUTHORIZED";
            localStorage.setItem('v12_database', JSON.stringify(v12_users));
            atualizarPainelAdmin();
            addLog(`OPERADOR ${v12_users[index].email} AUTORIZADO.`);
        }

        function removerUsuarioV12(email) {
            if (confirm("Remover permanentemente?")) {
                v12_users = v12_users.filter(u => u.email !== email);
                localStorage.setItem('v12_database', JSON.stringify(v12_users));
                atualizarPainelAdmin();
                addLog(`USU√ÅRIO REMOVIDO.`);
            }
        }
    </script>

    <script>
        // --- 4. FISCAL ---
        function calcFiscal() {
            const v = parseFloat(document.getElementById('valorInput').value) || 0;
            document.getElementById('cbsVal').innerText = `R$ ${(v * 0.009).toFixed(2)}`;
            document.getElementById('ibsVal').innerText = `R$ ${(v * 0.001).toFixed(2)}`;
            document.getElementById('liqVal').innerText = `R$ ${v.toFixed(2)}`;
        }
    </script>

    <script>
        function emitir(tipo) {
    const vTotal = parseFloat(document.getElementById('valorInput').value) || 0;
    const slot = document.getElementById('slotDestino').value;

    if (vTotal <= 0) return alert("ERRO: Valor de autoridade n√£o definido.");

    // Garante que a estrutura detalhada existe
    if (!v12_finance.detalhado) v12_finance.detalhado = {};

    // DIRECCIONAMENTO
    if (slot.startsWith('receita')) {
        v12_finance.receita += vTotal;
    } else {
        v12_finance.despesa += vTotal;
        // Alimenta o slot espec√≠fico (ex: obras)
        v12_finance.detalhado[slot] = (v12_finance.detalhado[slot] || 0) + vTotal;
    }

    // Persist√™ncia
    salvarTudoV12();
    if (typeof updateDRE === "function") updateDRE();

    // Com o slot definido, a nota fiscal agora sai detalhada
    gerarNotaV12(tipo, vTotal, slot);
}
    </script>

    <script>
       // 6. REMOVER USU√ÅRIO COM LOG DE AUDITORIA
function removerUsuarioV12(email) {
    // Evita que o admin se exclua por acidente
    const userAtual = v12_users.find(u => u.email === email);
    if (userAtual && userAtual.role === "ADMIN") {
        alert("ERRO CR√çTICO: N√£o √© poss√≠vel remover uma conta de ADMINISTRADOR.");
        return;
    }

    if (confirm(`CONFIRMAR EXCLUS√ÉO: ${email}?\nEsta a√ß√£o √© irrevers√≠vel no banco local.`)) {
        v12_users = v12_users.filter(u => u.email !== email);
        salvarEAtualizarV12();
        addLog(`USU√ÅRIO REMOVIDO: ${email}`);
    }
}

    </script>

    <script>
// 7. SALVAR E SINCRONIZAR DATABASE
function salvarEAtualizarV12() {
    try {
        localStorage.setItem('v12_database', JSON.stringify(v12_users));
        
        // Atualiza a interface se o painel existir
        if (typeof atualizarPainelAdmin === "function") {
            atualizarPainelAdmin();
        }
        
        // Feedback t√©cnico no terminal
        console.log("Database V12 Sincronizada.");
    } catch (e) {
        addLog("ERRO AO SALVAR: Mem√≥ria local cheia ou inacess√≠vel.");
    }
}
    </script>

    <script>
// 8. C√ÅLCULO FISCAL AVAN√áADO (Refletindo na DANFE e Painel)
function calcFiscal() {
    const valorRaw = document.getElementById('valorInput').value;
    const valor = parseFloat(valorRaw) || 0;
    
    // Regras tribut√°rias Sentinela V12
    const cbs = valor * 0.009; // Contribui√ß√£o sobre Bens e Servi√ßos
    const ibs = valor * 0.001; // Imposto sobre Bens e Servi√ßos
    const impostoTotal = cbs + ibs;

    // Atualiza√ß√£o din√¢mica dos elementos da interface
    const elementos = {
        'cbsVal': cbs,
        'ibsVal': ibs,
        'liqVal': valor
    };

    for (let [id, val] of Object.entries(elementos)) {
        const el = document.getElementById(id);
        if (el) {
            el.innerText = `R$ ${val.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            // Efeito visual de atualiza√ß√£o
            el.style.color = val > 0 ? "var(--active-orange)" : "inherit";
        }
    }
}

    </script>

    <script>
// 9. LIBERA√á√ÉO R√ÅPIDA DE OPERADOR
function liberarUsuario(email) {
    let userIndex = v12_users.findIndex(u => u.email === email);
    
    if (userIndex !== -1) {
        v12_users[userIndex].status = "AUTHORIZED";
        salvarEAtualizarV12();
        
        addLog(`AUTORIDADE CONCEDIDA: ${email.toUpperCase()}`);
        
        // Se estiver logado como admin, atualiza a tabela imediatamente
        if (document.getElementById('admin-panel')?.style.display === 'block') {
            atualizarPainelAdmin();
        }
    } else {
        addLog(`ERRO: Usu√°rio ${email} n√£o encontrado.`);
    }
}  


    </script>

    <script>
        
    let v12_finance = { receita: 0, despesa: 0, invest: 0 };
        
        // CORRE√á√ÉO: Fun√ß√£o de Login validando campos adicionados
        function checkV12Auth() {
            const email = document.getElementById('v12_email').value;
            const pass = document.getElementById('v12_pass').value;
            
            if(email.length > 5 && pass === "ihvh2026") {
                document.getElementById('auth-gate').style.display = 'none';
                addLog(`ACESSO AUTORIZADO: ${email.toUpperCase()}`);
                generateAIInsight("Sincroniza√ß√£o completa.");
            } else { 
                alert("ACESSO NEGADO: Verifique sua chave V12."); 
            }
        }
    </script>

    <script>
        
        function v12NeuralOCR(input) {
            addLog("IA: Processando documento...");
            setTimeout(() => {
                let val = Math.floor(Math.random() * 200) + 50;
                v12_finance.despesa += val;
                updateDRE();
                addLog(`DESPESA DETECTADA: R$ ${val},00`);
                generateAIInsight("Fluxo de sa√≠da detectado. IA correlacionando com movimenta√ß√µes de mercado.");
            }, 1000);
        }
    </script>

    <script>
        
        function updateDRE() {
            document.getElementById('dre_receita').innerText = `R$ ${v12_finance.receita.toFixed(2)}`;
            document.getElementById('dre_despesa').innerText = `R$ ${v12_finance.despesa.toFixed(2)}`;
            document.getElementById('dre_invest').innerText = `R$ ${v12_finance.invest.toFixed(2)}`;
        }
    </script>

    <script>
        
        let somaScanner = 0;
        let itensLidos = new Set();
        let html5QrCode = null;
        const SERIAL_P2 = "PB1F252F75254";
        const ACCESS_KEY = "20260112PB1F252F75254";

        async function capturarDadosRede() {
            addLog("Mapeando autoridade de Hardware...");
            setTimeout(() => {
                document.getElementById('network-badge').innerText = `P2: ${SERIAL_P2}`;
                document.getElementById('network-badge').className = "text-[9px] font-black bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded italic";
                addLog(`HARDWARE VALIDADO: Smart POS P2 [${SERIAL_P2}]`);
            }, 1000);
        }
    </script>

     <script>    
    // Tenta encontrar o ecr√£ de carregamento (logo) e escond√™-lo
    // Verifica se o teu HTML tem id="loading-screen" ou id="logo-overlay"
    const logo = document.getElementById('loading-screen') || document.getElementById('logo');
    
    if (logo) {
        logo.style.opacity = '0';
        setTimeout(() => { logo.style.display = 'none'; }, 500);
        console.log("Sistema Vis√≠vel.");
    } else {
        console.error("Erro: N√£o encontrei o ID do logo para apagar da tela.");
    }
};
    </script>

    <script>
        
        function executarPagamentoPOS() {
            const valor = document.getElementById('valorInput').value;
            if(!valor || valor == 0) return alert("Insira um valor.");
            v12_finance.receita += parseFloat(valor);
            updateDRE();
            addLog(`Invocando Hardware... R$ ${valor}`);
            generateAIInsight("Transa√ß√£o em curso via Antena P2. Registrando autoridade fiscal.");
            const intentUrl = `intent://pay?amount=${Math.round(valor*100)}&currency=BRL#Intent;scheme=infinitepay;package=com.infinitepay.checkout;S.browser_fallback_url=${window.location.href};end`;
            window.location.href = intentUrl;
        }

    </script>

    <script>

        async function toggleScanner() {
            const readerDiv = document.getElementById('reader');
            const btn = document.getElementById('btnScanner');
            if (!html5QrCode) { html5QrCode = new Html5Qrcode("reader"); }
            if (readerDiv.style.display === 'none' || readerDiv.style.display === '') {
                readerDiv.style.display = 'block';
                btn.innerText = "FECHAR C√ÇMERA (X)";
                await html5QrCode.start({ facingMode: "environment" }, { fps: 15, qrbox: 250 }, (txt) => {
                    if (itensLidos.has(txt)) return;
                    itensLidos.add(txt);
                    let p = Math.floor(Math.random() * 50) + 10;
                    somaScanner += p;
                    document.getElementById('valorInput').value = somaScanner.toFixed(2);
                    document.getElementById('descInput').value += `Item [${txt}] - R$ ${p},00\n`;
                    calcFiscal();
                    generateAIInsight(`Item identificado: ${txt}. Integridade do ativo confirmada.`);
                });
            } else {
                await html5QrCode.stop();
                readerDiv.style.display = 'none';
                btn.innerText = "Bipar Produtos";
            }
        }
    </script>
        
    <script>
        
        function motorBusca(val) {
            const doc = val.replace(/\D/g, '');
            if (doc.length === 11 || doc.length === 14) {
                const nomeInput = document.getElementById('nomeInput');
                nomeInput.readOnly = false;
                nomeInput.focus();
                addLog("Identidade Liberada.");
            }
        }
    </script>

    <script>
        
        function calcFiscal() {
            const v = parseFloat(document.getElementById('valorInput').value) || 0;
            document.getElementById('cbsVal').innerText = `R$ ${(v * 0.009).toFixed(2)}`;
            document.getElementById('ibsVal').innerText = `R$ ${(v * 0.001).toFixed(2)}`;
            document.getElementById('liqVal').innerText = `R$ ${v.toFixed(2)}`;
        }
    </script>

    <script>
        
        function addLog(msg) {
            const log = document.getElementById('logContent');
            log.innerHTML += `> [${new Date().toLocaleTimeString()}] ${msg}<br>`;
            log.scrollTop = log.scrollHeight;
        }
    </script>

    <script>
        
    // 2. VALIDA√á√ÉO B√ÅSICA
    if (!nome || !valorInput) {
        alert("Erro: Preencha o Nome e o Valor Operacional.");
        return;
    }

    </script>

    <script>
        
                function updateDRE() {
    // 1. C√°lculos de base
    const receitaTotal = v12_finance.receita;
    const totalImpostos = receitaTotal * 0.01; // CBS (0.9%) + IBS (0.1%)
    const lucroLiquido = receitaTotal - totalImpostos;
    </script>

    <script>
    // 2. Atualiza√ß√£o dos Elementos Visuais (Cards de Destaque)
    // Procure ou crie elementos com esses IDs no seu HTML
    if (document.getElementById('receita-display')) {
        document.getElementById('receita-display').innerText = `R$ ${receitaTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
    }

    </script>

    <script>
        
    if (document.getElementById('lucro-display')) {
        document.getElementById('lucro-display').innerText = `R$ ${lucroLiquido.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
        // Se o lucro for positivo, brilha em verde. Se negativo, vermelho.
        document.getElementById('lucro-display').style.color = lucroLiquido >= 0 ? "#10b981" : "#ef4444";
    }

    </script>

    <script>
        
    // 3. Log de Auditoria Financeira
    console.log(`[DRE V12] Sincronizado: Receita R$ ${receitaTotal.toFixed(2)} | Lucro R$ ${lucroLiquido.toFixed(2)}`);
}

    </script>

    <script>
                function updateDRE() {
    // 1. C√°lculos de base
    const receitaTotal = v12_finance.receita;
    const totalImpostos = receitaTotal * 0.01; // CBS (0.9%) + IBS (0.1%)
    const lucroLiquido = receitaTotal - totalImpostos;
                    
    // 3. PROCESSAMENTO FINANCEIRO E TRIBUT√ÅRIO
    const vTotal = parseFloat(valorInput) || 0;
    const fed = vTotal * 0.1345; // Exemplo de carga federal (13.45%)
    const est = vTotal * 0.07;   // Exemplo de carga estadual (7%)
    const totalImpostos = fed + est;
    const authCode = Math.floor(100000 + Math.random() * 900000); // C√≥digo de documento √∫nico
    const dataHora = new Date().toLocaleString('pt-BR');

    
    if (!nome || !valorInput) {
        alert("Erro: Preencha o Nome e o Valor Operacional.");
        return;
    }

    // PROCESSAMENTO FINANCEIRO V12
    const vTotal = parseFloat(valorInput) || 0;
    const fed = vTotal * 0.1345; 
    const est = vTotal * 0.07;   
    const totalImpostosVenda = fed + est;
    const authCode = Math.floor(100000 + Math.random() * 900000);
    const dataHora = new Date().toLocaleString('pt-BR');

    // ATUALIZA√á√ÉO DO CAIXA (SISTEMA DE AUTORIDADE)
    v12_finance.receita += vTotal;
    const receitaAcumulada = v12_finance.receita;
    const lucroAcumulado = receitaAcumulada * 0.99; // Considerando taxa operacional V12

    // ATUALIZA INTERFACE VISUAL
    updateDRE();
        
 </script>
                
    <script>

            if (vTotal <= 0) return alert("ERRO: Defina um valor de autoridade.");

    // 1. ATUALIZA O DRE INTERNO (Slots)
    if (!v12_finance.detalhado) v12_finance.detalhado = {};
    const authCode = Math.floor(Math.random() * 900000) + 100000;
    const dataHora = new Date().toLocaleString('pt-BR');

    if (slot.startsWith('receita')) {
        v12_finance.receita += vTotal;
    } else {
        v12_finance.despesa += vTotal;
        v12_finance.detalhado[slot] = (v12_finance.detalhado[slot] || 0) + vTotal;
    }

        </script>

                
             <script>
        
        function emitir(tipo) {
            const nome = document.getElementById('nomeInput').value;
            const valor = parseFloat(document.getElementById('valorInput').value) || 0;
            const desc = document.getElementById('descInput').value;
            if(!nome || valor <= 0) return alert("Erro: Preencha Nome e Valor.");
            
            const printArea = document.getElementById('print-area');
            const dataHora = new Date().toLocaleString('pt-BR'); 

    <script>

    // 2. DESENHA A NOTA DETALHADA (Seu c√≥digo A4)

        // VERS√ÉO A4 PREMIUM
        printArea.innerHTML = `
            <div style="font-family: 'JetBrains Mono', monospace; padding: 40px; border: 1px solid #ddd; background: #fff; position: relative; width: 210mm; min-height: 297mm; margin: auto;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 4px solid #000; padding-bottom: 20px;">
                    <div>
                        <h1 style="font-size: 40px; margin: 0; font-weight: 900;">SENTINELA V12</h1>
                        <p style="margin: 0;">SISTEMAS DE AUTORIDADE</p>
                        <p style="margin: 0; font-size: 12px;">SERIAL POS: ${SERIAL_P2}</p>
                    </div>
                    <div style="text-align: right; border: 2px solid #000; padding: 10px;">
                        <p style="margin: 0; font-size: 10px;">N√öMERO DO DOCUMENTO</p>
                        <h2 style="margin: 0;">#${authCode}</h2>
                    </div>
                </div>
                <div style="margin-top: 30px; background: #f4f4f4; padding: 15px; border-radius: 5px; display: grid; grid-template-columns: 1fr 1fr;">
                    <div>
                        <p style="margin: 0; font-size: 10px; color: #666;">CLIENTE</p>
                        <p style="margin: 0; font-weight: bold; font-size: 16px;">${nome.toUpperCase()}</p>
                        <p style="margin: 0;">CPF/CNPJ: ${doc}</p>
                    </div>
                    <div style="text-align: right;">
                        <p style="margin: 0; font-size: 10px; color: #666;">EMISS√ÉO</p>
                        <p style="margin: 0;">${dataHora}</p>
                    </div>
                </div>
                <div style="margin-top: 40px; display: flex; justify-content: space-between; align-items: flex-end;">
                    <div style="width: 50%; border: 1px solid #000; padding: 15px; background: #f9f9f9;">
                        <h3 style="margin: 0 0 10px 0; font-size: 12px; border-bottom: 1px solid #000;">CONSOLIDA√á√ÉO DRE TERMINAL</h3>
                        <p style="margin: 2px 0; font-size: 11px;">RECEITA BRUTA DIA: R$ ${receitaAcumulada.toFixed(2)}</p>
                        <p style="margin: 5px 0 0 0; font-size: 12px; font-weight: bold;">LUCRO L√çQUIDO: R$ ${lucroAcumulado.toFixed(2)}</p>
                    </div>
                    <div style="width: 300px; background: #000; color: #fff; padding: 20px; text-align: right;">
                        <h2 style="margin: 0; font-size: 24px;">TOTAL R$ ${vTotal.toFixed(2)}</h2>
                    </div>
                </div>
            </div>`;
    }

    </script>

    <script>

        
    // 3. COMANDO DE DISPARO (O que faltava)
    salvarTudoV12();
    if (typeof updateDRE === "function") updateDRE();
    
    // Pequeno delay para garantir que o HTML foi desenhado antes de imprimir
    setTimeout(() => {
        window.print();
    }, 500);
}

    </script>
    
    <script>

    // 2. C√ÅLCULOS NECESS√ÅRIOS (O que estava faltando)
    const vTotal = parseFloat(valorRaw) || 0;
    if (vTotal <= 0) {
        alert("ALERTA: Insira um valor v√°lido para emitir.");
        return;
    }
    </script>

        <script>

    const dataHora = new Date().toLocaleString('pt-BR');
    const fed = vTotal * 0.1345; // Imposto Federal
    const est = vTotal * 0.07;   // Imposto Estadual
    const totalImpostosVenda = fed + est;
    const authCode = Math.floor(100000 + Math.random() * 900000);

    </script>

      <script>

    // 3. ATUALIZA√á√ÉO DO FINANCEIRO (DRE)
    v12_finance.receita += vTotal;
    const receitaAcumulada = v12_finance.receita;
    const lucroAcumulado = receitaAcumulada * 0.99;

    </script>


             <script>
        
        function emitir(tipo) {
            const nome = document.getElementById('nomeInput').value;
            const valor = parseFloat(document.getElementById('valorInput').value) || 0;
            const desc = document.getElementById('descInput').value;
            if(!nome || valor <= 0) return alert("Erro: Preencha Nome e Valor.");
            
            const printArea = document.getElementById('print-area');
            const dataHora = new Date().toLocaleString('pt-BR'); 

    // 4. GERA√á√ÉO DO DOCUMENTO (O seu c√≥digo com as vari√°veis corrigidas)
    if (tipo === 'TERMICO') {
        printArea.innerHTML = `
            <div class="thermal-print-container" style="font-size: 12px; line-height: 1.2; width: 80mm; background: #fff; padding: 10px; color: #000; font-family: 'JetBrains Mono', monospace;">
                <div style="border: 2px solid #000; font-size: 20px; text-align: center; font-weight: 900; margin-bottom: 5px;">Gest√£o Acertiva</div>
                <p style="text-align:center; font-size: 9px; margin-bottom: 5px;">SISTEMA DE GEST√ÉO</p>
                <p style="text-align:center;">------------------------------------------</p>
                <p><b>DATA:</b> ${dataHora}</p>
                <p><b>CLIENTE:</b> ${nome.toUpperCase()}</p>
                <p><b>DOC:</b> ${doc}</p>
                <p style="text-align:center;">------------------------------------------</p>
                <table style="width: 100%; font-size: 10px;">
                    <tr style="border-bottom: 1px solid #000;">
                        <td align="left"><b>ITEM</b></td>
                        <td align="center"><b>QTD</b></td>
                        <td align="right"><b>TOTAL</b></td>
                    </tr>
                    <tr>
                        <td align="left">${desc.substring(0, 15)}...</td>
                        <td align="center">1</td>
                        <td align="right">R$ ${vTotal.toFixed(2)}</td>
                    </tr>
                </table>
                <p style="text-align:center;">------------------------------------------</p>
                <div style="text-align: right;">
                    <p style="margin:0;">Subtotal: R$ ${vTotal.toFixed(2)}</p>
                    <h2 style="margin: 0; font-size: 18px;">TOTAL: R$ ${vTotal.toFixed(2)}</h2>
                </div>
                <div style="margin-top: 10px; padding: 5px; border: 1px solid #000; background: #f9f9f9; font-size: 10px;">
                    <p style="margin:0; font-weight:bold; text-align:center;">RESUMO FINANCEIRO DO TERMINAL</p>
                    <p style="margin:0;">RECEITA ACUMULADA: R$ ${receitaAcumulada.toFixed(2)}</p>
                    <p style="margin:0;">LUCRO L√çQUIDO DIA: R$ ${lucroAcumulado.toFixed(2)}</p>
                </div>
                <p style="font-size: 9px; margin-top: 5px;">Trib. aprox: R$ ${fed.toFixed(2)} (Fed) e R$ ${est.toFixed(2)} (Est)</p>
                <p style="text-align:center; margin-top: 5px;"><b>AUTENTICA√á√ÉO HARDWARE</b><br>${ACCESS_KEY}</p>
            </div>`;

        </script>

        <script>
         
    } else {
       
        <script>

    // 5. COMANDOS DE FINALIZA√á√ÉO
    salvarEAtualizarV12(); // Salva no banco
    updateDRE();           // Atualiza o painel na tela
    addLog(`EMISS√ÉO REALIZADA: R$ ${vTotal.toFixed(2)} - ${nome}`);
    
    // Dispara a impress√£o
    window.print();
}

      </script>  
    
<script>
    addLog(`DRE INTEGRADO: Documento #${authCode} | Receita Dia: R$ ${receitaAcumulada.toFixed(2)}`);
    window.print();
}

 </script>

    <script>
        
        function validarNomeSeguro(el) {
            if(el.value.length > 0 && el.value.trim().split(' ').length < 2) {
                alert("NOME COMPLETO REQUERIDO.");
                el.focus();
            }
        }
</script>

    <script>
        // NOVO: Fun√ß√£o para gerar Insights din√¢micos da IA
        function generateAIInsight(text) {
            const aiDisplay = document.getElementById('ai-insight');
            aiDisplay.innerText = text;
            addLog(`SENTINELA ANAL√çTICO: ${text}`);
        }
    </script>
                
<script>
             
</body>
</html>
    
    

    </script>
