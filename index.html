<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>SENTINELA V12 - PORTAL NACIONAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .nfe-grid { display: grid; grid-template-columns: repeat(12, 1fr); border: 1px solid black; }
        .nfe-box { border: 0.5px solid black; padding: 2px; font-size: 8px; }
        @media print { .no-print { display: none; } #danfe-preview { display: block !important; } }
    </style>
</head>
<body class="bg-slate-950 text-white font-sans">
    <div class="no-print max-w-6xl mx-auto p-6">
        <header class="flex justify-between items-center border-b border-blue-500 pb-6 mb-8">
            <div>
                <h1 class="text-3xl font-black text-blue-500">SENTINELA <span class="text-white">V12</span></h1>
                <p class="text-xs text-slate-400 uppercase tracking-widest">Plataforma de Auditoria Nacional</p>
            </div>
            <div class="text-right">
                <div id="status" class="bg-green-500/10 text-green-500 border border-green-500/50 px-3 py-1 rounded-full text-[10px] font-bold inline-block">SISTEMA NACIONAL ATIVO</div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-slate-900 p-8 rounded-3xl border border-slate-800 shadow-2xl">
                    <h2 class="text-sm font-bold text-blue-400 mb-4 uppercase">Varredura de Contribuinte</h2>
                    <input type="text" id="docInput" placeholder="CNPJ / CPF do Cliente" class="w-full bg-black border-2 border-slate-800 rounded-2xl p-5 text-2xl font-mono text-blue-400 focus:border-blue-500 outline-none transition-all">
                    
                    <div class="grid grid-cols-2 gap-4 mt-6">
                        <button onclick="window.open('https://sso.acesso.gov.br/')" class="bg-white text-black font-bold py-4 rounded-xl hover:bg-slate-200 transition">ENTRAR GOV.BR</button>
                        <div class="relative group">
                            <button class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl">SUBIR CERTIFICADO</button>
                            <input type="file" id="certFile" class="absolute inset-0 opacity-0 cursor-pointer">
                        </div>
                    </div>
                </div>

                <div id="results" class="grid grid-cols-1 md:grid-cols-3 gap-4 opacity-50">
                    <div class="bg-black p-4 rounded-xl border border-slate-800">
                        <p class="text-[10px] text-slate-500 uppercase">Dívida Ativa</p>
                        <p id="resDivida" class="text-lg font-bold text-red-500">---</p>
                    </div>
                    <div class="bg-black p-4 rounded-xl border border-slate-800">
                        <p class="text-[10px] text-slate-500 uppercase">Status e-CAC</p>
                        <p id="resEca" class="text-lg font-bold text-blue-400">---</p>
                    </div>
                    <div class="bg-black p-4 rounded-xl border border-slate-800">
                        <p class="text-[10px] text-slate-500 uppercase">Simples Nac.</p>
                        <p id="resSimples" class="text-lg font-bold text-green-500">---</p>
                    </div>
                </div>
            </div>

            <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                <h2 class="text-sm font-bold text-blue-400 mb-6 uppercase">Emissão de NF-e / NFC-e</h2>
                <button onclick="gerarProtocolo()" class="w-full bg-green-600 hover:bg-green-500 text-white py-4 rounded-xl font-black shadow-lg transition transform active:scale-95 mb-4">
                    TRANSMITIR PARA SEFAZ
                </button>
                <button onclick="window.print()" class="w-full bg-slate-800 text-slate-300 py-3 rounded-xl font-bold text-xs">
                    IMPRIMIR DANFE TÉRMICA
                </button>
            </div>
        </div>
    </div>

    <div id="danfe-preview" class="hidden bg-white text-black p-4 w-[80mm] font-serif">
        <div class="text-center border-b border-black pb-2 mb-2">
            <p class="font-bold text-sm uppercase">DANFE NFC-e - Sentinela V12</p>
            <p class="text-[8px]">Documento Auxiliar da Nota Fiscal de Consumidor Eletrônica</p>
        </div>
        <div class="text-[9px] mb-2">
            <p><b>EMISSOR:</b> SISTEMA SENTINELA NACIONAL</p>
            <p><b>CNPJ:</b> 00.000.000/0001-00</p>
            <p>--------------------------------------------------</p>
            <p><b>DESTINATÁRIO:</b> <span id="nfDest">---</span></p>
        </div>
        <table class="w-full text-[9px] border-collapse">
            <thead><tr class="border-b border-black text-left"><th>ITEM</th><th>QTD</th><th>VLR</th></tr></thead>
            <tbody><tr><td>AUDITORIA FISCAL V12</td><td>1</td><td>R$ 1.200,00</td></tr></tbody>
        </table>
        <div class="mt-4 text-[8px] text-center">
            <p>CHAVE DE ACESSO SEFAZ:</p>
            <p class="font-bold">4326 0111 2026 0100 0000 0000 0000 0000 0000</p>
            <p class="mt-2 text-[7px]">Protocolo de Autorização: 135260000000001</p>
        </div>
    </div>

    <script>
        async function gerarProtocolo() {
            const doc = document.getElementById('docInput').value;
            if(!doc) return alert("Erro: CNPJ/CPF não informado.");
            
            document.getElementById('nfDest').innerText = doc;
            
            // Chama sua AWS Lambda
            try {
                const res = await fetch('https://x7rrkmlue3fbvk5j5awpfzy3he0jwoeq.lambda-url.sa-east-1.on.aws/', {
                    method: 'POST',
                    body: JSON.stringify({ cnpj: doc, mode: "BRAZIL_SCALE" }),
                    headers: {'Content-Type': 'application/json'}
                });
                const data = await res.json();
                
                document.getElementById('results').classList.remove('opacity-50');
                document.getElementById('resDivida').innerText = data.diagnostico.pgfn_divida;
                document.getElementById('resEca').innerText = data.diagnostico.receita_federal;
                document.getElementById('resSimples').innerText = data.diagnostico.simples_nacional;
                
                alert("NF-e Transmitida com Sucesso via PlugNotas!");
            } catch(e) {
                alert("Erro na conexão AWS: " + e);
            }
        }
    </script>
</body>
</html>
