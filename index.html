<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>SENTINELA V12 - AUTORIDADE SOBERANA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print { .no-print { display: none !important; } #cupom-fiscal { display: block !important; width: 80mm; } }
        .thermal-font { font-family: 'Courier New', monospace; }
        .glow-blue { box-shadow: 0 0 20px rgba(37, 99, 235, 0.4); }
        .glow-red { box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); }
        .scanline { background: linear-gradient(to bottom, rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%; pointer-events: none; }
        .loading-bar { height: 2px; width: 0%; background: #3b82f6; transition: width 0.5s; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 p-4 font-sans selection:bg-blue-500">
    <div class="max-w-6xl mx-auto bg-slate-900 rounded-3xl overflow-hidden no-print border border-slate-800 shadow-2xl relative">
        <div class="absolute inset-0 scanline opacity-10"></div>
        <div id="loader" class="loading-bar relative z-20"></div>

        <div class="p-8 bg-black flex flex-col md:flex-row justify-between items-center border-b border-blue-900/50 relative z-10">
            <div class="flex items-center gap-4">
                <div id="statusPulse" class="w-4 h-4 bg-green-500 rounded-full animate-pulse shadow-[0_0_10px_#22c55e]"></div>
                <div>
                    <h1 class="text-4xl font-black text-blue-500 tracking-tighter">SENTINELA V12</h1>
                    <p class="text-[10px] uppercase tracking-[0.4em] text-slate-500 font-bold">SOVEREIGN FISCAL MONITORING</p>
                </div>
            </div>
            <div class="text-right">
                <span class="text-[10px] text-blue-400 font-mono block">NODE_ID: CRISTIAN_SOVEREIGN</span>
                <span class="text-[9px] text-slate-600 uppercase">Status: Conectado ao e-CAC via AWS</span>
            </div>
        </div>

        <div class="p-8 grid grid-cols-1 lg:grid-cols-4 gap-8 relative z-10">
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-black/50 p-6 rounded-2xl border border-slate-800">
                    <label class="block text-[10px] font-black text-blue-500 mb-4 uppercase tracking-[0.2em]">Entrada de Identificador</label>
                    <input type="text" id="docInput" maxlength="18" placeholder="00.000.000/0000-00" 
                        class="w-full bg-slate-950 border-2 border-slate-800 rounded-xl p-6 text-3xl font-mono text-blue-400 outline-none focus:border-blue-500 transition-all shadow-2xl">
                    <div id="docType" class="text-[9px] mt-2 text-slate-500 font-bold uppercase">Aguardando Documento...</div>
                </div>

                <div id="displayResult" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-5 bg-black rounded-2xl border border-slate-800">
                        <span class="text-[10px] text-slate-500 block font-bold mb-1">RECEITA FEDERAL</span>
                        <p id="resEcac" class="font-bold text-slate-400">---</p>
                    </div>
                    <div class="p-5 bg-black rounded-2xl border border-slate-800">
                        <span class="text-[10px] text-slate-500 block font-bold mb-1">TAXA CALCULADA</span>
                        <p id="resImposto" class="font-bold text-slate-400">R$ 0,00</p>
                    </div>
                </div>

                <button onclick="executarVarredura()" id="btnAction" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-6 rounded-2xl shadow-xl transition-all transform active:scale-95 border-b-4 border-blue-800 uppercase tracking-widest">
                    Iniciar Varredura de Autoridade
                </button>
            </div>

            <div class="lg:col-span-1 space-y-4">
                <div class="bg-black p-6 rounded-3xl border border-slate-800 h-full flex flex-col">
                    <h3 class="text-xs font-bold text-blue-500 uppercase mb-4 flex justify-between">
                        <span>Console Log</span>
                        <span class="animate-pulse">●</span>
                    </h3>
                    <div id="consoleLog" class="text-[10px] font-mono text-green-500/80 space-y-2 overflow-y-auto flex-grow h-[300px]">
                        <p>> Sistema pronto.</p>
                    </div>
                </div>
            </div>

            <div class="space-y-4 text-center">
                <div class="p-6 bg-gradient-to-b from-slate-800 to-black rounded-3xl border border-slate-700">
                    <p class="text-xs font-bold text-slate-400 mb-6 uppercase">Ações Governamentais</p>
                    <button onclick="window.open('https://sso.acesso.gov.br/')" class="w-full mb-3 bg-white text-black text-[10px] font-black py-3 rounded-lg hover:bg-slate-200 transition">LOGIN GOV.BR</button>
                    <button onclick="transmitirSefaz()" class="w-full mb-3 bg-green-600 text-white text-[10px] font-black py-3 rounded-lg hover:bg-green-500 transition">TRANSMITIR SEFAZ</button>
                    <button onclick="window.print()" class="w-full bg-slate-800 text-white text-[10px] font-black py-3 rounded-lg hover:bg-slate-700 transition">IMPRIMIR TÉRMICA</button>
                </div>
                <div class="p-4">
                    <a href="https://www.certisign.com.br/" target="_blank" class="text-[9px] text-amber-500 underline font-bold uppercase">Comprar Certificado Digital</a>
                </div>
            </div>
        </div>
    </div>

    <div id="cupom-fiscal" class="hidden thermal-font text-black bg-white p-6 w-[80mm]">
        <center><p class="font-bold text-xl">SENTINELA V12</p></center>
        <p>--------------------------------</p>
        <p>DOC: <span id="cpDoc">---</span></p>
        <p>DATA: <span id="cpData">---</span></p>
        <p>--------------------------------</p>
        <div id="cpBody"></div>
        <p>--------------------------------</p>
        <center><p class="text-[10px]">AUTENTICAÇÃO SOBERANA MIT</p></center>
    </div>

    <script>
        function addLog(msg, type = 'info') {
            const consoleLog = document.getElementById('consoleLog');
            const color = type === 'error' ? 'text-red-500' : 'text-green-500/80';
            consoleLog.innerHTML += `<p class="${color}">> ${msg}</p>`;
            consoleLog.scrollTop = consoleLog.scrollHeight;
        }

        // Validação e Máscara Dinâmica
        document.getElementById('docInput').addEventListener('input', function(e) {
            let val = e.target.value.replace(/\D/g, '');
            if(val.length <= 11) {
                document.getElementById('docType').innerText = "Identificado: Pessoa Física (CPF)";
            } else {
                document.getElementById('docType').innerText = "Identificado: Pessoa Jurídica (CNPJ)";
            }
        });

        async function executarVarredura() {
            const doc = document.getElementById('docInput').value;
            const btn = document.getElementById('btnAction');
            const loader = document.getElementById('loader');

            if(doc.length < 11) {
                addLog("ERRO: Documento Inválido", "error");
                return alert("Insira um CPF ou CNPJ completo.");
            }

            btn.disabled = true;
            btn.innerText = "PROCESSANDO...";
            loader.style.width = "70%";
            addLog(`Iniciando varredura e-CAC para: ${doc}`);

            try {
                const response = await fetch('https://x7rrkmlue3fbvk5j5awpfzy3he0jwoeq.lambda-url.sa-east-1.on.aws/', {
                    method: 'POST',
                    body: JSON.stringify({ cnpj: doc, source: "SENTINELA_V12_UI" }),
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();
                
                // Atualização Visual Assertiva
                loader.style.width = "100%";
                document.getElementById('resEcac').innerText = data.diagnostico.receita_federal;
                document.getElementById('resEcac').className = "font-bold text-blue-400";
                
                document.getElementById('resImposto').innerText = data.diagnostico.simples_nacional;
                document.getElementById('resImposto').className = "font-bold text-green-400";

                // Prepara Cupom
                document.getElementById('cpDoc').innerText = doc;
                document.getElementById('cpData').innerText = new Date().toLocaleString();
                document.getElementById('cpBody').innerHTML = `<p>STATUS: ${data.diagnostico.receita_federal}</p><p>DIVIDA: ${data.diagnostico.pgfn_divida}</p><p>IMPOSTO: ${data.diagnostico.simples_nacional}</p>`;

                addLog("Handshake AWS concluído. Diagnóstico Gerado.");
                setTimeout(() => loader.style.width = "0%", 1000);

            } catch (e) {
                addLog(`ERRO DE CONEXÃO: ${e}`, "error");
                alert("Falha na comunicação com a AWS.");
            } finally {
                btn.disabled = false;
                btn.innerText = "Iniciar Varredura de Autoridade";
            }
        }

        function transmitirSefaz() {
            addLog("Iniciando Transmissão SEFAZ via PlugNotas...");
            alert("Aguardando Assinatura do Certificado Digital...");
        }
    </script>
</body>
</html>
